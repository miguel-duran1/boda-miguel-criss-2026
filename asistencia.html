<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirma tu Asistencia - Boda de Miguel y Cristina</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="scroll-progress.js" defer></script>
    <script src="translations.js" defer></script>
    <style>
        .form-container {
            max-width: 600px;
            margin: 0 auto;
            margin-top: 60px; /* Añadir espacio para evitar que se solape con el header fijo */
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 8px rgba(166, 123, 91, 0.2);
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #5A4A42;
        }
        
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #D8B48C;
            border-radius: 5px;
            font-family: 'Georgia', serif;
            font-size: 1rem;
            color: #5A4A42;
            background-color: #fff;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            border-color: #A67B5B;
            outline: none;
            box-shadow: 0 0 5px rgba(166, 123, 91, 0.3);
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
        }
        
        .radio-option input {
            margin-right: 5px;
        }
        
        .submit-btn {
            background: linear-gradient(to right, #A67B5B, #D8935F);
            color: white;
            border: none;
            padding: 14px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        
        .page-header {
            background: linear-gradient(to right, #A67B5B, #D8B48C);
            color: white;
            padding: 40px 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            margin-top: 60px; /* Añadir espacio para evitar que se solape con el header fijo */
        }
        
        .success-message {
            display: none;
            background-color: rgba(126, 178, 138, 0.2);
            color: #3c763d;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
            text-align: center;
            border-left: 4px solid #3c763d;
        }
        
        .required {
            color: #d63031;
            margin-left: 3px;
        }
        
        .back-link {
            display: inline-block;
            margin-top: 30px;
            color: #5A4A42;
            text-decoration: none;
            padding: 10px 20px;
            background-color: #EAD7C1;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        
        .back-link:hover {
            background-color: #D8B48C;
        }
        
        .dietary-options {
            margin-top: 10px;
        }
        
        .important-date {
            font-weight: bold;
            color: #A67B5B;
        }
        
        .form-status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        
        .form-status.success {
            display: block;
            background-color: rgba(126, 178, 138, 0.2);
            color: #3c763d;
            border-left: 4px solid #3c763d;
        }
        
        .form-status.error {
            display: block;
            background-color: rgba(217, 83, 79, 0.2);
            color: #a94442;
            border-left: 4px solid #a94442;
        }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="header-container">
            <div class="logo" id="menu-toggle">M&C</div>
            
            <div class="language-selector">
                <button data-lang="es" class="active" title="Español">ES</button>
                <button data-lang="ca" title="Català">CA</button>
            </div>
            
            <nav>
                <ul id="menu">
                    <li style="--i:1"><a href="index.html#hero" data-i18n="nav.inicio">Inicio</a></li>
                    <li style="--i:2"><a href="index.html#info" data-i18n="nav.informacion">Información</a></li>
                    <li style="--i:3"><a href="index.html#countdown" data-i18n="nav.cuenta-atras">Cuenta Atrás</a></li>
                    <li style="--i:4"><a href="index.html#rsvp" data-i18n="nav.asistencia">Asistencia</a></li>
                    <li style="--i:5"><a href="index.html#gifts" data-i18n="nav.lista-regalos">Lista de Regalos</a></li>
                    <li style="--i:6"><a href="index.html#location" data-i18n="nav.ubicacion">Ubicación</a></li>
                    <li style="--i:7"><a href="index.html#contact" data-i18n="nav.contacto">Contacto</a></li>
                </ul>
            </nav>
        </div>
    </header>
    
    <div class="menu-overlay" id="menu-overlay"></div>
    
    <main>
        <section>
            <div class="page-header">
                <h1 data-i18n="rsvp-page.title">Confirma tu Asistencia</h1>
                <p data-i18n="rsvp-page.subtitle">¡Nos encantaría contar contigo en nuestro gran día!</p>
                <p><span data-i18n="rsvp-page.deadline">Por favor, confirma antes del</span> <span class="important-date" data-i18n="rsvp-page.deadline-date">1 de marzo de 2026</span></p>
            </div>
            
            <div class="form-container">
                <form id="rsvp-form" action="https://formspree.io/f/xeoarpne" method="POST">
                    <div class="form-group">
                        <label for="email" data-i18n="rsvp-page.email">Email<span class="required">*</span></label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="name" data-i18n="rsvp-page.name">Nombre completo<span class="required">*</span></label>
                        <input type="text" id="name" name="name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone" data-i18n="rsvp-page.phone">Teléfono</label>
                        <input type="tel" id="phone" name="phone">
                    </div>
                    
                    <div class="form-group">
                        <label data-i18n="rsvp-page.attending">¿Asistirás a nuestra boda?<span class="required">*</span></label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="attending-yes" name="attending" value="yes" required>
                                <label for="attending-yes" data-i18n="rsvp-page.attending-yes">Sí, asistiré</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="attending-no" name="attending" value="no">
                                <label for="attending-no" data-i18n="rsvp-page.attending-no">No podré asistir</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group" id="guests-group">
                        <label for="guests" data-i18n="rsvp-page.guests">Número de invitados (incluyéndote)</label>
                        <input type="number" id="guests" name="guests" min="1" value="1">
                    </div>
                    
                    <div class="form-group" id="dietary-group">
                        <label for="dietary" data-i18n="rsvp-page.dietary">¿Tienes alguna restricción alimentaria?</label>
                        <select id="dietary" name="dietary">
                            <option value="none">No, ninguna</option>
                            <option value="vegetarian">Vegetariano</option>
                            <option value="vegan">Vegano</option>
                            <option value="gluten">Sin gluten</option>
                            <option value="other">Otra</option>
                        </select>
                        
                        <div id="dietary-details" class="dietary-options" style="display: none;">
                            <label for="dietary-specifics" data-i18n="rsvp-page.dietary-specify">Por favor, especifica tus restricciones alimentarias:</label>
                            <textarea id="dietary-specifics" name="dietary-specifics" rows="3"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="message" data-i18n="rsvp-page.message">¿Te gustaría dejar algún mensaje para los novios?</label>
                        <textarea id="message" name="message" rows="4"></textarea>
                    </div>
                    
                    <input type="hidden" name="_subject" value="Nueva confirmación de asistencia - Boda Miguel y Cristina">
                    
                    <button type="submit" class="submit-btn" data-i18n="rsvp-page.submit">Confirmar Asistencia</button>
                    
                    <div id="form-status" class="form-status"></div>
                </form>
                
                <div class="success-message" id="success-message">
                    <h3 data-i18n="rsvp-page.success-title">¡Gracias por confirmar tu asistencia!</h3>
                    <p data-i18n="rsvp-page.success-message1">Hemos recibido tu respuesta correctamente.</p>
                    <p data-i18n="rsvp-page.success-message2">Estamos deseando compartir contigo nuestro día especial.</p>
                </div>
                
                <a href="index.html" class="back-link" data-i18n="rsvp-page.back">← Volver a la página principal</a>
            </div>
        </section>
    </main>
    
    <footer>
        <p data-i18n="footer.copyright"> Copyright © 2026 Miguel & Cristina. Todos Los Derechos Reservados </p>
    </footer>
    
    <script>
        // Manejar el menú hamburguesa
        document.addEventListener("DOMContentLoaded", function() {
            const menuToggle = document.getElementById("menu-toggle");
            const menu = document.getElementById("menu");
            const overlay = document.getElementById("menu-overlay");
            
            // Asegurarse de que el menú esté oculto inicialmente
            menu.classList.add('hidden');
            
            menuToggle.addEventListener("click", function() {
                menuToggle.classList.toggle("active");
                menu.classList.toggle("active");
                
                if (menu.classList.contains('active')) {
                    menu.classList.remove('hidden');
                    overlay.classList.add('active');
                } else {
                    setTimeout(() => {
                        if (!menu.classList.contains('active')) {
                            menu.classList.add('hidden');
                        }
                    }, 500);
                    overlay.classList.remove('active');
                }
            });
            
            // Cerrar el menú al hacer click en el overlay
            overlay.addEventListener('click', function() {
                menuToggle.classList.remove('active');
                menu.classList.remove('active');
                overlay.classList.remove('active');
                
                setTimeout(() => {
                    if (!menu.classList.contains('active')) {
                        menu.classList.add('hidden');
                    }
                }, 500);
            });
            
            // Cerrar el menú al hacer click en un enlace
            const menuLinks = document.querySelectorAll('nav ul li a');
            menuLinks.forEach(link => {
                link.addEventListener('click', function() {
                    menuToggle.classList.remove('active');
                    menu.classList.remove('active');
                    overlay.classList.remove('active');
                    
                    setTimeout(() => {
                        if (!menu.classList.contains('active')) {
                            menu.classList.add('hidden');
                        }
                    }, 500);
                });
            });
            
            // Función para actualizar las opciones del select según el idioma
            function updateSelectOptions() {
                const currentLang = localStorage.getItem('wedding-language') || 'es';
                const dietarySelect = document.getElementById('dietary');
                const options = dietarySelect.querySelectorAll('option');
                
                const translations = {
                    es: {
                        'none': 'No, ninguna',
                        'vegetarian': 'Vegetariano',
                        'vegan': 'Vegano',
                        'gluten': 'Sin gluten',
                        'other': 'Otra'
                    },
                    ca: {
                        'none': 'No, cap',
                        'vegetarian': 'Vegetarià',
                        'vegan': 'Vegà',
                        'gluten': 'Sense gluten',
                        'other': 'Altres'
                    }
                };
                
                options.forEach(option => {
                    const value = option.getAttribute('value');
                    if (translations[currentLang] && translations[currentLang][value]) {
                        option.textContent = translations[currentLang][value];
                    }
                });
            }
            
            // Actualizar opciones cuando cambie el idioma
            document.addEventListener('languageChanged', updateSelectOptions);
            
            // Actualizar opciones al cargar
            updateSelectOptions();
            
            // Mostrar u ocultar el detalle de restricciones alimentarias
            const dietarySelect = document.getElementById('dietary');
            const dietaryDetails = document.getElementById('dietary-details');
            
            dietarySelect.addEventListener('change', function() {
                if (this.value === 'other') {
                    dietaryDetails.style.display = 'block';
                } else {
                    dietaryDetails.style.display = 'none';
                }
            });
            
            // Mostrar u ocultar campos relacionados con la asistencia
            const attendingYes = document.getElementById('attending-yes');
            const attendingNo = document.getElementById('attending-no');
            const guestsGroup = document.getElementById('guests-group');
            const dietaryGroup = document.getElementById('dietary-group');
            
            // Inicializar campos según la selección
            if (attendingYes.checked) {
                guestsGroup.style.display = 'block';
                dietaryGroup.style.display = 'block';
            } else if (attendingNo.checked) {
                guestsGroup.style.display = 'none';
                dietaryGroup.style.display = 'none';
            }
            
            attendingYes.addEventListener('change', function() {
                if (this.checked) {
                    guestsGroup.style.display = 'block';
                    dietaryGroup.style.display = 'block';
                }
            });
            
            attendingNo.addEventListener('change', function() {
                if (this.checked) {
                    guestsGroup.style.display = 'none';
                    dietaryGroup.style.display = 'none';
                }
            });

            // Manejo del envío del formulario con AJAX
            const form = document.getElementById('rsvp-form');
            const formStatus = document.getElementById('form-status');
            const successMessage = document.getElementById('success-message');
            
            async function handleSubmit(event) {
                event.preventDefault();
                
                // Mostrar indicador de carga
                const currentLang = localStorage.getItem('wedding-language') || 'es';
                const sendingText = currentLang === 'ca' ? 'Enviant la teva resposta...' : 'Enviando tu respuesta...';
                formStatus.innerHTML = sendingText;
                formStatus.style.display = "block";
                formStatus.className = "form-status";
                
                try {
                    const data = new FormData(form);
                    
                    // Actualizar valores de los campos según el idioma antes de enviar
                    const attendingValue = data.get('attending');
                    if (attendingValue === 'yes') {
                        data.set('attending', currentLang === 'ca' ? 'Sí, assistiré' : 'Sí, asistiré');
                    } else if (attendingValue === 'no') {
                        data.set('attending', currentLang === 'ca' ? 'No podré assistir' : 'No podré asistir');
                    }
                    
                    const dietaryValue = data.get('dietary');
                    const dietaryTranslations = {
                        es: { 'none': 'No, ninguna', 'vegetarian': 'Vegetariano', 'vegan': 'Vegano', 'gluten': 'Sin gluten', 'other': 'Otra' },
                        ca: { 'none': 'No, cap', 'vegetarian': 'Vegetarià', 'vegan': 'Vegà', 'gluten': 'Sense gluten', 'other': 'Altres' }
                    };
                    if (dietaryValue && dietaryTranslations[currentLang] && dietaryTranslations[currentLang][dietaryValue]) {
                        data.set('dietary', dietaryTranslations[currentLang][dietaryValue]);
                    }
                    
                    const response = await fetch(form.action, {
                        method: form.method,
                        body: data,
                        headers: {
                            'Accept': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        // Ocultar formulario y mostrar mensaje de éxito
                        form.style.display = 'none';
                        successMessage.style.display = 'block';
                        successMessage.scrollIntoView({behavior: 'smooth'});
                    } else {
                        const responseData = await response.json();
                        const currentLang = localStorage.getItem('wedding-language') || 'es';
                        const errorText = currentLang === 'ca' 
                            ? 'Ho sentim, ha ocorregut un problema en enviar el formulari. Si us plau, torna-ho a intentar.'
                            : 'Lo sentimos, ha ocurrido un problema al enviar el formulario. Por favor, inténtalo de nuevo.';
                        if (Object.hasOwn(responseData, 'errors')) {
                            formStatus.innerHTML = responseData.errors.map(error => error.message).join(", ");
                        } else {
                            formStatus.innerHTML = errorText;
                        }
                        formStatus.className = "form-status error";
                    }
                } catch (error) {
                    console.error('Error:', error);
                    const currentLang = localStorage.getItem('wedding-language') || 'es';
                    const errorText = currentLang === 'ca' 
                        ? 'Ho sentim, ha ocorregut un problema en enviar el formulari. Si us plau, torna-ho a intentar.'
                        : 'Lo sentimos, ha ocurrido un problema al enviar el formulario. Por favor, inténtalo de nuevo.';
                    formStatus.innerHTML = errorText;
                    formStatus.className = "form-status error";
                }
            }
            
            // Añadir el manejador de eventos al formulario
            form.addEventListener('submit', handleSubmit);
        });
    </script>
</body>
</html> 